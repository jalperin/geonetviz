<!DOCTYPE html>
<html lang="en">
	<head>
			<meta charset="utf-8">
			<link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
			<link href="/static/style.css" rel="stylesheet" media="screen">

		<script src="http://d3js.org/d3.v2.min.js?2.9.6" type="text/javascript">
</script>
<script type="text/javascript">
	// pull out the Dataset ID
	var pathArray = window.location.pathname.split( '/' );
	var ds_id = "";

	// handle trailing slash
	// FIXME? grab second element, or element after "get"?
	while ( !(ds_id = pathArray.pop()) ) {}
</script>
		<style type="text/css">

		svg {
		  font: 10px sans-serif;
		}

		.background {
		fill: none;
		pointer-events: all;
		}

		#countries {
		fill: #aaa;
		stroke: #fff;
		stroke-width: 1.5px;
		}

		 #states path {
		   fill: #ccc;
		   stroke: #fff;
		 }

		 .arc {
		   pointer-events: none;
		   fill: none;
		   stroke: #999;
		   stroke-opacity: 0.4;
		 }

		 #matrixview {
			 float: left;
		 }

         #statsview {
             float: left;
         }

		 #mapview {
			 float:left;
	   	 }

		.node {
		  stroke: #fff;
		  stroke-width: 1.5px;
		}

		.link {
		  stroke: #999;
		  stroke-opacity: .6;
		}

        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .bar {
          fill: steelblue;
        }

        .x.axis path {
          display: none;
  }

.nav li.dropdown ul.dropdown-menu li:HOVER ul
 
{
 
display:block;
 
position:absolute;
 
left:100%;
 
-webkit-border-radius: 3px;
 
-moz-border-radius: 3px;
 
border-radius: 3px;
 
}
 
&nbsp;
 
.nav li.dropdown ul.dropdown-menu ul
 
{
 
display: none;
 
float:right;
 
position: relative;
 
top: auto;
 
margin-top: -30px;
 
}
 
&nbsp;
 
.nav li.dropdown ul.dropdown-menu .dropdown-menu::before
 
{
 
content: '';
 
display: inline-block;
 
border-top: 7px solid transparent;
 
border-bottom: 7px solid transparent;
 
border-right:7px solid #CCC;
 
border-right-color: rgba(0, 0, 0, 0.2);
 
position: absolute;
 
top: 9px;
 
left: -14px;
 
}
 
&nbsp;
 
.nav li.dropdown ul.dropdown-menu .dropdown-menu::after
 
{
 
content: '';
 
display: inline-block;
 
border-top: 6px solid transparent;
 
border-bottom: 6px solid transparent;
 
border-right:6px solid white;
 
position: absolute;
 
top: 10px;
 
left: -12px;
 
}
</style>
		<title></title>
	</head>
	<body>

			<div class="container">
		<p>.</p>
		<div class="inline">
  			<h1 style="margin-top:30px;">GeoNetViz</h1>
			<p class="pull-right"><a href="#" id="about-views" rel="popover" data-content="The purpose of this tool is to allow a user to view a network in different ways, revealing new features of the data through each view. The map view highlights the geographical nature of the data. The node-link view ignores geography (aside from the color of the nodes by region and the tooltips), but shows how the locations cluster according to the ties between them. The matrix view enables sorting and provides yet another perspective on how the network is structured." data-original-title="What is GeoNetViz?">About Views</a></p>
		</div>

		<p style="margin-top:20px; margin-bottom:20px;">Explore your network data using three different views and then stats. Zoom. Drag. Hover. Filter. What do you see?</p>
		<div class="tabbable">

		<ul class="nav nav-tabs">
			<li class="active"><a href="#mapview" data-toggle="tab">Map View</a></li>
			<li class=""><a href="#nodelinkview" data-toggle="tab">Node-Link View</a></li>
			<li class=""><a href="#matrixview" data-toggle="tab">Matrix View</a></li>
			<li class=""><a href="#statsview" data-toggle="tab">Statistics</a></li>
			<li class="dropdown pull-right"><a href="#menu1" data-toggle="dropdown" class="dropdown-toggle"> Filter<b class="caret"></b></a>		
				<ul id="filter-options" class="dropdown-menu"> 
				</ul>
				</li>
    	</ul>

		<div class="tab-content">
			<div class="tab-pane active" id="mapview">
				<div id="map"> </div>
			</div>
			<div class="tab-pane" id="nodelinkview">
				<div id="nodelink"> </div>
			</div>
			<div class="tab-pane" id="matrixview">
				<div id="matrix">
					<p>Order: <select id="order">
					  <option value="name">by Name</option>
					  <option value="weight">by Weight</option>
					  <option value="region">by Region</option>
					</select>
				</div>
			</div>
            <div class="tab-pane" id="statsview">
                <div id="stats"> </div>
            </div>
	</div>



    	</div>

		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<script src="/static/bootstrap/js/bootstrap.min.js"></script>
		<script src="/static/Tooltip.js"></script>


		<script src="/static/map.js" type="text/javascript"></script>
		<script src="/static/nodelink.js" type="text/javascript"></script>
		<script src="/static/matrix.js" type="text/javascript"></script>
        <script src="/static/stats.js" type="text/javascript"></script>

		<script type="text/javascript">
			// a common colour scale for ordinal data
			var colourscale = d3.scale.category20();

			// FIXME: when "this" issue is resolved, these should not be needed as globals
			var map = new Map();
			map.init();
			var nodelink = new NodeLink();
			nodelink.init();
			var matrix = new Matrix();
			matrix.init();
            var stats = new Stats();

			var views = [map, nodelink, matrix, stats];
			var attributes = [];
			var all_keys = [];
			var other_attr = [];
			var exclude = "lat lng country_name country_code id degree pagerank degree_centrality average_neighbor_degree closeness_vitality";

			function appendDropdown() {
				for(i = 0; i < attributes.length; i++) {
					if(exclude.indexOf(attributes[i]) == -1) {
							var txt1 = "<li><a href='&#35;'> by " + attributes[i] + " <i class='icon-arrow-right'></i></a>";
							var txt2 = "<ul class='dropdown-menu'> <li><a href='&#35'>Africa</a></li>  </ul></li>";
						$("#filter-options").append(txt1, txt2); 
					}
				}
			}

			function updateViews(ds_id, filters) {
				d3.json("/get/" + ds_id + "/?" + filters, function(network) {
					attributes = d3.keys(network.nodes[0]);
					all_keys =  d3.keys(network.nodes[0]);
					for(i = 1; i < all_keys.length; i++) {
						if(exclude.indexOf(all_keys[i]) == -1) {
							other_attr.push(all_keys[i]);
						}
					}
					appendDropdown();
				for ( var i=0; i < views.length; i++ ) {
					var networkClone = jQuery.extend(true, {}, network);
					views[i].loadNetwork(networkClone);
				}
				});
			}

		updateViews(ds_id);

		</script>
						

	<script>
$(function ()
{ $("#about-views").popover({placement:'bottom'});
});
</script>
	</body>
</html>
